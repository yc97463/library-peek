(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3354:(e,t,a)=>{Promise.resolve().then(a.bind(a,23394))},23394:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>en});var r=a(95155),s=a(26072),n=a(49509);let i={cache:"no-store",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}},l=n.env.NEXT_PUBLIC_API_ENDPOINT||"https://library-peek.deershark-tech.workers.dev/api",d=n.env.NEXT_PUBLIC_BASE_PATH||"",o=e=>fetch("".concat(l).concat(d).concat(e),i).then(e=>e.json());var c=a(12115),u=a(99708),m=a(74466),x=a(52596),h=a(39688);function g(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,h.QP)((0,x.$)(t))}let f=(0,m.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function p(e){let{className:t,variant:a,size:s,asChild:n=!1,...i}=e,l=n?u.DX:"button";return(0,r.jsx)(l,{"data-slot":"button",className:g(f({variant:a,size:s,className:t})),...i})}var v=a(5196),y=a(53904),b=a(74311),j=a(91981),N=a(83013),w=a(42355),k=a(13052),_=a(43900);function A(e){let{className:t,classNames:a,showOutsideDays:s=!0,...n}=e;return(0,r.jsx)(_.hv,{showOutsideDays:s,className:g("p-3",t),classNames:{months:"flex flex-col sm:flex-row gap-2",month:"flex flex-col gap-4",caption:"flex justify-center pt-1 relative items-center w-full",caption_label:"text-sm font-medium",nav:"flex items-center gap-1",nav_button:g(f({variant:"outline"}),"size-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-x-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:g("relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-range-end)]:rounded-r-md","range"===n.mode?"[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md":"[&:has([aria-selected])]:rounded-md"),day:g(f({variant:"ghost"}),"size-8 p-0 font-normal aria-selected:opacity-100"),day_range_start:"day-range-start aria-selected:bg-primary aria-selected:text-primary-foreground",day_range_end:"day-range-end aria-selected:bg-primary aria-selected:text-primary-foreground",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,r.jsx)(w.A,{className:g("size-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,r.jsx)(k.A,{className:g("size-4",t),...a})}},...n})}var E=a(99531);function M(e){let{...t}=e;return(0,r.jsx)(E.bL,{"data-slot":"popover",...t})}function z(e){let{...t}=e;return(0,r.jsx)(E.l9,{"data-slot":"popover-trigger",...t})}function D(e){let{className:t,align:a="center",sideOffset:s=4,...n}=e;return(0,r.jsx)(E.ZL,{children:(0,r.jsx)(E.UC,{"data-slot":"popover-content",align:a,sideOffset:s,className:g("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...n})})}var S=a(69074);function F(e){let{dates:t,selected:a,onSelect:s}=e,n=new Date(a),i=t.map(e=>new Date(e)),l=(0,N.GP)(new Date,"yyyy-MM-dd"),d=(0,N.GP)(new Date(Date.now()-864e5),"yyyy-MM-dd"),o=t.includes(l),c=t.includes(d);return(0,r.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,r.jsx)(p,{variant:a===d?"default":"outline",onClick:()=>c&&s(d),disabled:!c,className:"cursor-pointer",children:"昨日"}),(0,r.jsx)(p,{variant:a===l?"default":"outline",onClick:()=>o&&s(l),disabled:!o,className:"cursor-pointer",children:"今日"}),(0,r.jsxs)(M,{children:[(0,r.jsx)(z,{asChild:!0,children:(0,r.jsxs)(p,{variant:"outline",className:g("w-[200px] justify-start text-left font-normal cursor-pointer",!a&&"text-muted-foreground"),children:[(0,r.jsx)(S.A,{className:"mr-2 h-4 w-4"}),a?(0,N.GP)(n,"yyyy-MM-dd EEEE").replace("Monday","星期一").replace("Tuesday","星期二").replace("Wednesday","星期三").replace("Thursday","星期四").replace("Friday","星期五").replace("Saturday","星期六").replace("Sunday","星期日"):"選擇日期"]})}),(0,r.jsx)(D,{className:"w-auto p-0",align:"start",children:(0,r.jsx)(A,{mode:"single",selected:n,onSelect:e=>e&&s((0,N.GP)(e,"yyyy-MM-dd")),disabled:e=>!i.some(t=>t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()),initialFocus:!0})})]})]})}function C(e){let{dates:t,selectedDate:a,onDateChange:s,viewMode:n,onViewModeChange:i,onRefresh:l,isFullscreen:d,onFullscreenToggle:o}=e,[u,m]=(0,c.useState)(180),[x,h]=(0,c.useState)(!1),[g,f]=(0,c.useState)(!1);(0,c.useEffect)(()=>{let e;return g||(e=setInterval(()=>{m(e=>e<=1?(N(),180):e-1)},1e3)),()=>{e&&clearInterval(e)}},[g]);let N=()=>{l(),h(!0),f(!0),setTimeout(()=>{h(!1),f(!1),m(180)},3e3)};return(0,r.jsxs)("div",{className:"flex justify-between items-center gap-6 flex-wrap",children:[(0,r.jsx)(F,{dates:t,selected:a,onSelect:s}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(p,{variant:"all"===n?"default":"outline",onClick:()=>i("all"),className:"cursor-pointer",children:"全日"}),(0,r.jsx)(p,{variant:"1h"===n?"default":"outline",onClick:()=>i("1h"),className:"cursor-pointer",children:"近 1 小時"}),(0,r.jsx)(p,{variant:"3h"===n?"default":"outline",onClick:()=>i("3h"),className:"cursor-pointer",children:"近 3 小時"}),(0,r.jsx)(p,{variant:"6h"===n?"default":"outline",onClick:()=>i("6h"),className:"cursor-pointer",children:"近 6 小時"}),(0,r.jsx)(p,{variant:"outline",onClick:N,className:"cursor-pointer flex gap-2 ".concat(x?"bg-green-500 text-white hover:bg-green-600 hover:text-white":""," w-24"),children:x?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(v.A,{className:"h-4 w-4"}),"已更新"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.A,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:[Math.floor(u/60),":",(u%60).toString().padStart(2,"0")]})]})}),(0,r.jsx)(p,{variant:"outline",size:"icon",onClick:o,className:"cursor-pointer",children:d?(0,r.jsx)(b.A,{className:"h-4 w-4"}):(0,r.jsx)(j.A,{className:"h-4 w-4"})})]})]})}let L=(0,m.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function P(e){let{className:t,variant:a,asChild:s=!1,...n}=e,i=s?u.DX:"span";return(0,r.jsx)(i,{"data-slot":"badge",className:g(L({variant:a}),t),...n})}var T=a(33109),I=a(68500),W=a(87712);function O(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card",className:g("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function G(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:g("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function X(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:g("leading-none font-semibold",t),...a})}function B(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:g("px-6",t),...a})}function K(e){let{title:t,value:a,extra:s,className:n="",icon:i}=e;return(0,r.jsxs)(O,{className:"relative overflow-hidden ".concat(n),children:[i&&(0,r.jsx)("div",{className:"absolute -right-2 -bottom-[32px]",children:(0,r.jsx)("div",{className:"h-36 w-36",children:i})}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)(G,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(X,{className:"text-sm font-medium",children:t}),s]}),(0,r.jsx)(B,{children:(0,r.jsx)("div",{className:"text-2xl font-bold",children:a})})]})]})}function R(e){let{data:t,viewMode:a}=e;if(!t.length)return(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,r.jsx)(K,{title:"目前人數",value:0}),(0,r.jsx)(K,{title:"".concat("all"===a?"全日":"時段","最高"),value:0}),(0,r.jsx)(K,{title:"".concat("all"===a?"全日":"時段","最低"),value:0}),(0,r.jsx)(K,{title:"".concat("all"===a?"全日":"時段","平均人數"),value:0})]});let s=t[t.length-1].count,n=t.length>1?t[t.length-2].count:s,i=Math.max(...t.map(e=>e.count)),l=t.map(e=>e.count).filter(e=>e>0).sort((e,t)=>e-t)[0]||0,d=Math.round(t.reduce((e,t)=>e+t.count,0)/t.length),o=s>n?{badge:(0,r.jsx)(P,{className:"bg-emerald-100 text-emerald-700 hover:bg-emerald-100",children:"增加中"}),icon:(0,r.jsx)(T.A,{className:"absolute right-4 bottom-4 h-24 w-24 text-emerald-100"}),className:"bg-emerald-50"}:s<n?{badge:(0,r.jsx)(P,{className:"bg-rose-100 text-rose-700 hover:bg-rose-100",children:"減少中"}),icon:(0,r.jsx)(I.A,{className:"absolute right-4 bottom-4 h-24 w-24 text-rose-100"}),className:"bg-rose-50"}:{badge:(0,r.jsx)(P,{className:"bg-sky-100 text-sky-700 hover:bg-sky-100",children:"持平"}),icon:(0,r.jsx)(W.A,{className:"absolute right-4 bottom-4 h-24 w-24 text-sky-100"}),className:"bg-sky-50"};return(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,r.jsx)(K,{title:"目前人數",value:s,extra:o.badge,className:o.className,icon:o.icon}),(0,r.jsx)(K,{title:"".concat("all"===a?"全日":"時段","最高"),value:i}),(0,r.jsx)(K,{title:"".concat("all"===a?"全日":"時段","最低"),value:l}),(0,r.jsx)(K,{title:"".concat("all"===a?"全日":"時段","平均人數"),value:d})]})}var U=a(83540),V=a(56965),Y=a(94754),q=a(96025),H=a(16238),Q=a(94517),Z=a(21374);function $(e){let{data:t,height:a}=e,s="#000000",n="#666666",i="#FFFFFF";return(0,r.jsx)("div",{style:{width:"100%",height:a},className:"relative",children:(0,r.jsx)(O,{className:"absolute inset-0 p-4",children:(0,r.jsx)(U.u,{width:"100%",height:"100%",children:(0,r.jsxs)(V.b,{data:t,margin:{top:20,right:20,bottom:20,left:20},children:[(0,r.jsx)(Y.d,{strokeDasharray:"3 3",vertical:!1,stroke:n,opacity:.2}),(0,r.jsx)(q.W,{dataKey:"time",tickLine:!1,axisLine:!1,tickMargin:8,stroke:n,fontSize:12,tickFormatter:e=>new Date(e).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit",hour12:!1})}),(0,r.jsx)(H.h,{tickLine:!1,axisLine:!1,tickMargin:8,stroke:n,fontSize:12}),(0,r.jsx)(Q.m,{content:e=>{let{active:t,payload:a,label:s}=e;return t&&a?(0,r.jsxs)("div",{className:"rounded-lg border bg-background/80 backdrop-blur-sm p-2 shadow-sm",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:new Date(s).toLocaleTimeString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1})}),a.map(e=>(0,r.jsxs)("p",{className:"text-sm font-medium flex items-center gap-2",children:[(0,r.jsx)("span",{className:"w-2 h-2 rounded-full",style:{background:e.stroke}}),(0,r.jsxs)("span",{children:[e.name," ",e.value," 人"]})]},e.name))]}):null}}),(0,r.jsx)(Z.N,{name:"人數",type:"monotone",dataKey:"count",stroke:s,strokeWidth:2,dot:{r:3,fill:i,stroke:s,strokeWidth:2},activeDot:{r:6,fill:s,stroke:i,strokeWidth:2}}),(0,r.jsx)(Z.N,{name:"趨勢",type:"monotone",dataKey:"trend",stroke:n,strokeWidth:1.5,strokeDasharray:"5 5",dot:!1})]})})})})}var J=a(14186),ee=a(34869),et=a(99245),ea=a(33237),er=a(5040);function es(){return(0,r.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,r.jsx)(ea.P.div,{animate:{rotate:360,scale:[1,1.1,1],opacity:[1,.8,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:(0,r.jsx)(er.A,{className:"h-8 w-8 text-primary"})}),(0,r.jsxs)(ea.P.span,{animate:{opacity:[.5,1,.5]},transition:{duration:1.5,repeat:1/0},className:"text-sm text-muted-foreground gap-2",children:["載入人數資料中",(0,r.jsx)("span",{className:"absolute",children:"⋯"})]})]})}function en(){let{data:e}=(0,s.Ay)("/dates",o,{refreshInterval:18e4}),[t,a]=(0,c.useState)(""),{data:n,mutate:i}=function(e){let{data:t,error:a,isLoading:r,mutate:n}=(0,s.Ay)(e?"/daily?date=".concat(e):null,o,{refreshInterval:e&&e===new Date().toISOString().split("T")[0]?18e4:0,fallbackData:[],revalidateOnMount:!0});return{data:t||[],error:a,isLoading:r,mutate:n}}(t),[l,d]=(0,c.useState)(!1),[u,m]=(0,c.useState)("all"),x=(0,c.useRef)(null);(0,c.useEffect)(()=>{Array.isArray(e)&&e.length&&a(e[e.length-1])},[e]),(0,c.useEffect)(()=>{let e=()=>{d(null!==document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]);let h=async()=>{try{!document.fullscreenElement&&x.current?await x.current.requestFullscreen():document.fullscreenElement&&await document.exitFullscreen()}catch(e){console.error("Error toggling fullscreen:",e)}};if(!Array.isArray(e)||!e.length||!Array.isArray(n)||!n.length)return(0,r.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,r.jsx)(es,{})});let g=(e=>{switch(u){case"1h":return e.slice(-12);case"3h":return e.slice(-36);case"6h":return e.slice(-72);default:return e}})(n),f=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],a=e.map(e=>e.count).map((e,t,a)=>{let r=a.slice(Math.max(0,t-2),Math.min(a.length,t+3));return r.reduce((e,t)=>e+t,0)/r.length}),r=e.map((e,t)=>({time:e.timestamp,count:e.count,trend:a[t],isEmpty:0===e.count}));return t?r:r.filter(e=>!e.isEmpty)}(g,!1);return(0,r.jsx)("div",{ref:x,className:"".concat(l?"fixed inset-0 z-50 bg-background flex flex-col overflow-hidden":""),children:(0,r.jsx)("div",{className:"container mx-auto ".concat(l?"flex-1 py-4 flex flex-col min-h-0":"py-8"," space-y-4"),children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 h-full",children:[(0,r.jsx)("h1",{className:"font-bold ".concat(l?"text-2xl":"text-3xl"),children:"東華圖書館在館人數趨勢"}),(0,r.jsxs)("div",{className:"w-full ".concat(l?"flex-1 flex flex-col min-h-0 gap-4":"space-y-6"),children:[(0,r.jsx)(C,{dates:e,selectedDate:t,onDateChange:a,viewMode:u,onViewModeChange:m,onRefresh:i,isFullscreen:l,onFullscreenToggle:h}),(0,r.jsx)(R,{data:g,viewMode:u}),(0,r.jsx)("div",{className:"".concat(l?"flex-1 min-h-0 flex w-full":"w-full"),children:(0,r.jsx)("div",{className:"w-full h-full flex flex-col",children:(0,r.jsx)("div",{className:"flex-1 min-h-0",children:(0,r.jsx)($,{data:f,height:l?"100%":"400px"})})})}),(0,r.jsx)("footer",{className:"rounded-lg border bg-card ".concat(l?"p-4":"p-6"," shadow-sm"),children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-primary",children:"更新資訊"}),(0,r.jsxs)("div",{className:"flex flex-col space-y-3 text-sm text-muted-foreground",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(J.A,{className:"h-4 w-4 text-primary/70"}),(0,r.jsx)("span",{children:"資料每 5 分鐘更新一次"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(ee.A,{className:"h-4 w-4 text-primary/70"}),(0,r.jsx)("span",{children:"頁面每 3 分鐘自動重新整理"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-primary md:text-right",children:"其他資訊"}),(0,r.jsxs)("div",{className:"flex flex-col space-y-3 text-sm text-muted-foreground md:items-end",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 md:flex-row-reverse",children:[(0,r.jsx)("span",{children:new Date(n[n.length-1].timestamp).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}),(0,r.jsx)(S.A,{className:"h-4 w-4 text-primary/70"}),(0,r.jsx)("span",{className:"md:hidden",children:"上次更新："}),(0,r.jsx)("span",{className:"hidden md:inline",children:"上次更新："})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 md:flex-row-reverse",children:[(0,r.jsx)("a",{href:"https://lib.ndhu.edu.tw",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"東華大學圖書館"}),(0,r.jsx)(et.A,{className:"h-4 w-4 text-primary/70"}),(0,r.jsx)("span",{children:"資料來源："})]})]})]})]})})]})]})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[395,441,684,358],()=>t(3354)),_N_E=e.O()}]);